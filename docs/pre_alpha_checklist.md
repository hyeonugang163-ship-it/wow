# MJTalk PTT Pre-Alpha 체크리스트

프리알파(Android) APK를 소수 지인에게 배포하기 전에, 최소한으로 돌려봐야 할 수동 QA 체크리스트입니다.  
**실제 명령 실행 / 설치 / 배포는 항상 사람이 직접** 수행한다고 가정합니다.

---

## 1. 빌드 / 환경 설정

- [ ] 현재 빌드 환경 확인
  - [ ] `APP_ENV=alpha` 로 실행/빌드했는지 확인  
    - 예시: `flutter run --dart-define=APP_ENV=alpha`  
    - 예시: `flutter build apk --debug --dart-define=APP_ENV=alpha`
- [ ] AppEnvironment 별 기본 정책 이해
  - **dev**
    - 개발용.
    - FakeBackend / FakeTransport 기본 ON.
    - 디버그 메뉴(PTT 디버그 오버레이, 로그 뷰어 등) 모두 노출.
  - **alpha**
    - 프리알파용.
    - 기본은 FakeBackend / FakeTransport, 필요한 경우에만 토글.
    - 디버그 메뉴는 필요한 부분만 노출(일반 테스터가 헷갈리지 않도록).
  - **prod**
    - 배포용.
    - RealBackend / 실제 VoiceTransport 전제.
    - 일반 유저용으로 Dev/Debug 메뉴 대부분 숨김.
- [ ] 프리알파 빌드는 **가능하면 `alpha` 환경**으로만 만든다는 점을 재확인
  - [ ] 테스터에게 전달 시, 환경(`dev/alpha/prod`)이 어디인지 설명.

---

## 2. PTT 핵심 플로우 (Walkie / Manner)

### 2.1 매너모드(Manner) 음성 노트

- [ ] 전역 모드를 **Manner**로 설정 (기본값이 Manner인지도 확인)
  - [ ] 홈/Settings에서 현재 PTT 모드 표시가 `Manner`로 보이는지 확인.
- [ ] 채팅방에서 PTT 버튼을 **0.3~0.5초 짧게 탭/연타**
  - [ ] `startTalk` / `stopTalk` 호출이 일어나지 않거나,  
        "1초 이상 길게 눌러야 녹음 가능" 등 안내가 보이는지 확인.
  - [ ] 인앱 디버그 로그(있다면)에서 `[PTT][UI] short tap ignored` 또는 유사 메시지를 확인.
- [ ] PTT 버튼을 **1초 이상 홀드 → 손을 떼기**
  - [ ] Debug 로그에서 아래와 비슷한 순서 확인
    - `[PTT] startTalk`
    - `[PTT] stopTalk`
    - `[PTT][Manner][addVoice] ...`
    - `[Chat] voice message added`
  - [ ] 해당 친구 채팅방에 **음성 버블**이 생성되는지 확인.
  - [ ] 음성 버블을 탭하면:
    - [ ] 재생/일시정지 동작 정상.
    - [ ] duration / 시각 표시가 깨지지 않는지.
    - [ ] 재생 실패 시 에러 메시지/토스트가 자연스럽게 뜨는지.

### 2.2 무전모드(Walkie) + Foreground Service

- [ ] 전역 모드를 **Walkie**로 전환
  - [ ] 모드 스위치 UI에서 `Walkie`/`무전모드`로 표시되는지 확인.
- [ ] 친구 프로필에서 **"무전 허용" 토글 ON**
  - [ ] 상단/프로필에 "무전 허용 친구" 상태가 노출되는지 확인.
- [ ] Walkie 모드 + 무전 허용 친구 대상, **1초 이상 홀드 → 송신**을 여러 번 반복
  - [ ] 말하는 동안 Android 상단에 **Foreground Service 알림**이 나타나는지 확인  
        (예: 마이크/무전 관련 알림).
  - [ ] 손을 떼면 FGS 알림이 **짧은 지연 후 사라지거나 종료**되는지 확인.
  - [ ] 디버그 로그에서:
    - `[PTT][Android][FGS] startForeground` / `stopForeground` 류 로그 확인.
    - `ForegroundServiceDidNotStartInTimeException` 등 예외 로그가 없는지 확인.
- [ ] Walkie 모드에서 수신 측 UX
  - [ ] (현재 FakeBackend/FakeTransport 기준) **동일 디바이스 내 루프백/시뮬레이션**에서:
    - [ ] 수신 시 짧은 알림음(삑) 이후 음성이 재생되는지 (향후 구현 시 확인).
    - [ ] 무음/진동 상태에서도, OS가 허용하는 범위에서 음악 앱처럼 재생되는지.

### 2.3 쿨다운 / 레이트리밋 / Block

- [ ] 동일 친구에게 짧은 간격으로 PTT를 빠르게 반복
  - [ ] 일정 횟수 이후, 버튼이 잠시 비활성화되거나 시각적으로 쿨다운 표시가 있는지.
  - [ ] 인앱 로그에서  
        `[PTT][RateLimit] startTalk blocked by cooldown`  
        또는 유사 메시지 확인.
- [ ] 1분 내 동일 친구에게 **20회 이상** 시도 (또는 설정된 기준 이상)
  - [ ] 추가 시도에서 송신이 제한되는지.
  - [ ] 로그에서  
        `[PTT][RateLimit] friend burst friendId=...`  
        메시지 확인.
- [ ] 친구를 **Block 상태**로 만든 뒤 PTT 시도
  - [ ] PTT 버튼이 빨갛게/차단 아이콘 등으로 표시되는지.
  - [ ] 실제 녹음/송신이 시작되지 않는지.
  - [ ] 로그에서  
        `[PTT][Policy] startTalk blocked by friendBlock`  
        또는 유사 메시지 확인.

---

## 3. Android 라이프사이클 / 오디오 포커스

- [ ] **말하는 중 홈 버튼**을 눌러 앱을 백그라운드로 보냄
  - [ ] FGS 알림이 자연스럽게 정리되는지.
  - [ ] 다시 앱으로 돌아왔을 때 "말하는 중" 상태가 남아 있지 않은지.
- [ ] **말하는 중 화면 꺼짐/켜기**
  - [ ] 화면이 꺼졌다 켜져도 크래시/멈춤 현상이 없는지.
  - [ ] 세션이 적절히 종료되고, 다시 말하기 동작이 정상적으로 되는지.
- [ ] **말하는 중 다른 앱(음악/유튜브 등) 재생**
  - [ ] 다른 앱이 오디오 포커스를 가져가면 자동으로 `stopTalk` 처리되는지.
  - [ ] 로그에서
    - `[PTT][AudioFocus] LOSS`
    - `[PTT][State] isTalking -> false (reason=audio_focus_loss)`
    - 와 비슷한 메시지 확인.
- [ ] 다른 앱에서 음악 재생 중 MJTalk에서 PTT 시도
  - [ ] AudioFocus 요청에 따라 음악이 일시 중지/duck 되는지.
  - [ ] PTT 종료 후 음악이 적절히 복구되는지.

---

## 4. Auth / 온보딩

- [ ] 앱 삭제 후 재설치 → 실행
  - [ ] 최초 실행 시 온보딩(닉네임/아바타 등) 화면이 정상적으로 나타나는지.
- [ ] 온보딩 완료 후 홈 진입
  - [ ] 다음 실행부터는 온보딩 없이 바로 홈으로 진입하는지.
  - [ ] 프로필/닉네임이 상단/설정 화면에 제대로 반영되는지.
- [ ] Settings에서 **로그아웃**
  - [ ] 로그아웃 후 앱을 다시 열면 온보딩/로그인 플로우로 돌아가는지.

---

## 5. Friends / Block / 신고

- [ ] Friends 목록
  - [ ] 진입 시 로딩/스켈레톤이 자연스럽게 보이는지.
  - [ ] 스크롤/검색(있다면) 동작이 부드러운지.
- [ ] 각 친구별 **"무전 허용" 토글 ON/OFF**
  - [ ] 토글 ON/OFF 시 상태가 즉시 UI에 반영되는지.
  - [ ] FakeBackend 기준으로 `[Friends][AllowWalkie] friendId=...` 등 로그가 찍히는지.
- [ ] **Block / Unblock** 동작
  - [ ] Block 시 친구 리스트/채팅방 등에 차단 상태가 반영되는지.
  - [ ] Block 시 해당 친구에 대한 "무전 허용"이 자동으로 OFF 되거나 무시되는지.
  - [ ] Unblock 후 다시 PTT/채팅이 가능한지.
- [ ] **신고(Abuse) 플로우**
  - [ ] 신고 버튼 탭 → 신고 이유 선택 → 전송까지 자연스러운지.
  - [ ] 로그에서
    - `[Safety][Report]`
    - `[Safety][ReportApi]`
    - 와 같은 메타데이터 로그만 남고,  
      **텍스트/음성 내용 자체는 로그에 남지 않는지** 확인.

---

## 6. Chat / 음성 노트

- [ ] 1:1 채팅 기본 동작
  - [ ] 텍스트 메시지 입력/전송/표시가 정상인지.
  - [ ] 스크롤, 오래된 메시지 로딩 등 기본 UX 확인.
- [ ] 음성 노트 버블
  - [ ] Manner 모드에서 녹음한 음성 노트가 채팅에 버블로 나타나는지.
  - [ ] 버블 탭 시 재생/일시정지 동작이 기대대로인지.
  - [ ] 재생 위치 표시(파형/진행바 등)가 너무 튀지 않는지.
  - [ ] 재생 실패 시 UI/토스트가 자연스러운지.
- [ ] 메시지/음성 혼합
  - [ ] 텍스트/음성 메시지가 섞여 있어도 레이아웃이 깨지지 않는지.

---

## 7. Settings / Dev / 디버그 로그

- [ ] Settings 화면에서 **현재 AppEnvironment(dev/alpha/prod)** 표기 확인
  - [ ] 실제 빌드에 사용한 `APP_ENV` 값과 일치하는지.
- [ ] dev / alpha 환경에서 Dev/Debug 메뉴
  - [ ] FakeBackend / FakeTransport 토글이 있다면 ON/OFF 시 동작 확인.
  - [ ] PTT 디버그 오버레이 ON/OFF 시:
    - [ ] PTT 동작 중에 지터/레이트/오디오 포커스 등 디버그 정보가 보이는지.
  - [ ] "디버그 로그 보기" 진입
    - [ ] 로그가 실시간으로 추가되는지.
    - [ ] 필터링/검색(있다면) 동작 확인.
    - [ ] 로그 지우기/초기화 버튼이 정상 동작하는지.
    - [ ] "리포트 복사" / "Issue Report 복사" 기능이 클립보드에 텍스트를 제대로 복사하는지.
- [ ] prod 환경에서 Dev 메뉴 노출 여부
  - [ ] 일반 유저에게 보이면 안 되는 메뉴가 숨겨져 있는지 (정책에 따라).

---

## 8. 알려진 제약사항 / 아직 안 되는 것

이 릴리스는 **프리알파(Android 단일 디바이스 중심)** 테스트를 위한 버전입니다.  
아래는 현재 시점에서 의도적으로 제한된 부분/아직 구현되지 않은 부분입니다.

- 서버 / 네트워크
  - [ ] 기본 가정은 **FakeBackend / FakeVoiceTransport**입니다.
  - [ ] 실제 상용 서버 / LiveKit SFU에 연결하지 않습니다.
  - [ ] 메시지/친구/무전 기록은 **기기 로컬**에만 저장되며,  
        다른 디바이스와 동기화되지 않습니다.
- iOS
  - [ ] iOS 코드는 아직 설계/뼈대 수준입니다.
  - [ ] iOS 빌드/테스트는 Mac + iOS 디바이스 환경에서 **별도 진행 예정**입니다.
  - [ ] iOS Push-to-Talk 프레임워크(B안) / CallKit / VoIP Push는 아직 붙어 있지 않습니다.
- Firebase / 푸시
  - [ ] FCM / Firebase Auth / APNs 등 푸시/인증 연동은 아직 적용되지 않았습니다.
  - [ ] 이번 프리알파는 **푸시 없이, 앱 실행 상태에서의 PTT/채팅 UX**에만 초점을 둡니다.
- 보안 / 프라이버시
  - [ ] E2E 암호화(WebRTC Insertable Streams) 등 고급 보안 기능은 이후 버전(v2+)에서 확장 예정입니다.

---

## 9. APK 빌드 / 지인 배포

> **중요:** 여기 적힌 명령어는 모두 예시입니다.  
> 실제로 명령을 실행하고, APK를 배포하는 책임은 **사람(개발자)**에게 있습니다.

- [ ] 빌드 전
  - [ ] `git status`로 코드 변경사항을 정리했는지 확인.
  - [ ] 현재 체크아웃된 브랜치/커밋이 안정적인지 확인.
  - [ ] `APP_ENV=alpha` 환경으로 빌드할지 다시 한 번 확인.
- [ ] Debug APK 빌드 예시 (텍스트 안내용)
  - 예: `flutter build apk --debug --dart-define=APP_ENV=alpha`
  - 필요하다면 `--release` 대신 내부 테스트용 `--debug` 또는 `--profile`을 선택.
- [ ] 지인에게 APK 전달 시
  - [ ] Android 설정에서 **"알 수 없는 앱 설치 허용"** 안내를 충분히 했는지.
  - [ ] 이 문서(`Pre-Alpha 체크리스트`)와 **버그 리포트 템플릿**을 함께 전달했는지.
  - [ ] 테스터에게 "이 버전은 프리알파이며, 데이터가 초기화될 수 있고,  
        서버/푸시/E2E 암호화 등이 완전하지 않다"는 점을 사전에 공지.

---

## 10. 버그 리포트 템플릿

테스터가 복붙해서 쓸 수 있는 기본 양식입니다.  
이 문단 전체를 복사해서 메신저/이메일 등에 붙여 넣어 사용하면 됩니다.

```text
[환경]
- 앱 버전: (설정 → 앱 정보에서 확인)
- 환경: dev / alpha / prod (Settings에 표시된 값)
- 디바이스: (예: Galaxy S23, Android 15)
- 네트워크: Wi-Fi / LTE

[재현 시나리오]
1) 
2) 
3) 

[기대한 동작]

[실제 동작]

[스크린샷/화면 녹화 여부]
- (선택) 이미지/영상 첨부

[인앱 이슈 리포트]
- Settings → 디버그 로그 → "리포트 복사" → 여기 아래에 붙여넣기
(여기에 Debug Issue Report 텍스트 붙여주세요)
```

---

## 11. 앞으로의 확장 포인트 (문서 TODO)

향후 기능이 붙었을 때 체크리스트를 어떻게 확장할지에 대한 TODO입니다.  
실제 구현/연동 후 이 문서를 업데이트해야 합니다.

- Firebase / FCM 푸시 연동 후
  - [ ] 푸시 수신 → 탭 → 앱 포그라운드 진입 → PTT 재생/채팅 열기 플로우 추가.
  - [ ] 알림 카테고리(무전/메시지/친구요청)별 테스트 케이스 추가.
  - [ ] Notification 채널 별 진동/사운드 설정 확인.
- RealBackend / LiveKit SFU 연동 후
  - [ ] 실제 서버/LiveKit에 연결된 상태에서 PTT 딜레이(TTP), 품질(끊김, 지연)을 측정하는 항목 추가.
  - [ ] 네트워크 상태(Wi-Fi / LTE / 3G / 로스율)에 따른 품질 체크리스트 추가.
  - [ ] 서버 측 rate limit / abuse detection과 클라이언트 레이트리밋이 잘 맞물리는지 확인하는 항목 추가.
- iOS / Cross-Platform
  - [ ] iOS A안(MVP: APNs → 탭 → 포그라운드 → 재생)용 체크리스트 별도 섹션 추가.
  - [ ] iOS B안(Push-to-Talk 프레임워크 / iOS 18+)용 잠금화면/백그라운드 테스트 항목 추가.
  - [ ] Android/iOS 간 친구/채팅/PTT 상호작용 크로스 테스트 항목 추가.
- 보안 / 프라이버시 강화
  - [ ] E2E 암호화 적용 후 메시지/음성의 암복호화 실패 시나리오 테스트.
  - [ ] 로그/메트릭에 실제 내용이 남지 않는지 재검증하는 섹션 추가.

